# cap理论

CAP定理又称为CAP原则，指在一个分布式系统中，Consistency(一致性)、Availability(可用性)、
Partition tolerance(分区容错性)，最多只能同时满足2个，三者不可兼得。


CAP原理是对分布式数据存储系统的一个定论。如果一个分布式系统各个节点都读取同一个mysql实例，
那么对于这个分布式系统来说，讨论CAP理论时没有意义的。因为各个节点之间可以不用因为数据复制
而进行通信，满足分区容忍性（P），可以随时响应请求，满足可用性（A），同时因为访问的是一个数据库
实例，本身已经保证了数据一致性（C）。

在讨论CAP原理的时候，更多的是针对那些有数据存储、数据复制场景的分布式存储系统，也就是我们
熟悉的NoSql数据库。


## Consistency(一致性)

访问所有节点得到的数据应该是一样的。这里的一致性，是强一致性。即数据更新完，访问任何节点看到的数据
完全一致。

## availability(可用性)

所有节点都保持高可用性。这里的高可用不能出现延迟

## Partition tolerence(分区容忍性)

这里的分区是网络意义上的分区。由于网络是不可靠的，所有节点之间，可能出现无法通讯的情况，在节点
不能通讯时，要保证系统可以继续正常服务。

以实际效果而言，分区相当于对通信的时限要求。系统如果不能在时限内达成数据一致性，就意味着发生了分区的情况，必须就当前操作在C和A之间做出选择。


# CAP原理简单证明

假设有节点data1和节点data2，一开始有个数据number=1。之后向data1提交更新，将数据number设置为2。
接着data1就需要将更新推送给data2，让data2也更新number数据。

接下来我们分3个场景分析：

## 1. 在保证C和P的情况下

为了保证数据一致性，data1需要将数据复制给data2，即data1和data2需要进行通信。但是由于网络是不
可靠的，我们系统有保证了分区容忍性，也就是说这个系统是可以容忍网络的不可靠的。这时候data2就不一定能
及时的收到data1的数据复制消息，当有请求向data2访问number数据时，为了保证数据的一致性，data2只能
阻塞等待数据真正同步完成后再返回，这时候就没办法保证高可用性了。

所以，在保证C和P的情况下，是无法同时保证A的。

## 2. 在保证A和P的情况下
为了保证高可用性，data1和data2都有在有限时间内返回。同样由于网络的不可靠，在有限时间内，data2有可能还没收到data1发来的数据更新消息，这时候返回给客户端的可能是旧的数据，和访问data1的数据是不一致的，也就是违法了C。

也就是说，在保证A和P的情况下，是无法同时保证C的。

## 3. 在保证A和C的情况下
如果要保证高可用和一致性，只有在网络情况良好且可靠的情况下才能实现。这样data1才能立即将更新消息发送给data2。但是我们都知道网络是不可靠的，是会存在丢包的情况的。所以要满足即时可靠更新，只有将data1和data2放到一个区内才可以，也就丧失了P这个保证。其实这时候整个系统也不能算是一个分布式系统了。



# CAP原理在各个系统的应用

![image](https://github.com/williamzhang11/fastAlgorithm/blob/master/src/main/java/com/xiu/fastAlgorithm/image/cap.jpg)

https://blog.csdn.net/u013332124/article/details/82874178























